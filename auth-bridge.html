<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body style="background:black; color:lime;font-family:monospace;">
  <h2>ğŸ” Redirecting based on Supabase user status...</h2>

  <script>
    const supabase = supabase.createClient(
      'https://wnnutjefmnuhnhevyohi.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndubnV0amVmbW51aG5oZXZ5b2hpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzM5NzcsImV4cCI6MjA2MzA0OTk3N30.ElS2qrbByPUcqQkDTqH6C1NxmKaFeww9en4WOo9YH54'
    );

    document.addEventListener('DOMContentLoaded', async () => {
      const { data: sessionData } = await supabase.auth.getSession();
      const session = sessionData?.session;
      if (!session) {
        alert("preeminent-torrone-94b7a3.netlify.app ë‚´ìš©:

ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ");
        return;
      }

      const id = session.user.id;
      const email = session.user.email;

      const { data: userRow, error } = await supabase
        .from("users")
        .select("*")
        .eq("id", id)
        .maybeSingle();

      if (error) {
        alert("âŒ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨");
        return;
      }

      if (userRow?.nickname) {
        window.location.href = `/maintown?nickname=${encodeURIComponent(userRow.nickname)}`;
      } else {
        window.location.href = `/onboarding.html?id=${id}&email=${encodeURIComponent(email)}`;
      }
    });
  </script>
</body>
</html>